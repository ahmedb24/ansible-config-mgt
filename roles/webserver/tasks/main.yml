---
- name:  initial cleanup, remove /var/www/html/ directory if present
  become: true
  ansible.builtin.file:
    path: /var/www/html/
    state: absent

- name: install apache
  become: true
  ansible.builtin.yum:
    name: "httpd"
    state: present

- name: install git
  become: true
  ansible.builtin.yum:
    name: "git"
    state: present

- name: clone tooling repo
  become: true
  ansible.builtin.git:
    repo: https://github.com/ahmedb24/tooling
    dest: /var/www/html
    force: yes
  tags: tooling

- name: copy html content to one level up
  become: true
  command: cp -r /var/www/html/html/ /var/www/
  tags: tooling

- name: run the db initialize script
  become: true
  ansible.builtin.expect:
    command: 'mysql -h 54.197.64.27 -u admin -p < /var/www/html/tooling-db.sql'
    responses:
      (?i)password: "admin"
  tags: tooling

- name: clone todo repo
  become: true
  ansible.builtin.git:
    repo: https://github.com/ahmedb24/php-todo
    dest: /var/www/html
    force: yes
  tags: todo

- name: Start service httpd, if not started
  become: true
  ansible.builtin.service:
    name: httpd
    state: started

- name: recursively remove /var/www/html/html/ directory
  become: true
  ansible.builtin.file:
    path: /var/www/html/html
    state: absent
